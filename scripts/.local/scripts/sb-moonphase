#!/bin/sh

# Shows the current moon phase.

# ╠══════╬══════╬══════╬══════╬══════╣
# ║      ║ e38d ║ e38e ║ e38f ║ e390 ║
# ║      ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e391 ║ e392 ║ e393 ║ e394 ║ e395 ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e396 ║ e397 ║ e398 ║ e399 ║ e39a ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e39b ║ e39c ║ e39d ║ e39e ║ e39f ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3a0 ║ e3a1 ║ e3a2 ║ e3a3 ║ e3a4 ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3a5 ║ e3a6 ║ e3a7 ║ e3a8 ║
# ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬

# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3c8 ║ e3c9 ║ e3ca ║ e3cb ║ e3cc ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3cd ║ e3ce ║ e3cf ║ e3d0 ║ e3d1 ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3d2 ║ e3d3 ║ e3d4 ║ e3d5 ║ e3d6 ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3d7 ║ e3d8 ║ e3d9 ║ e3da ║ e3db ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3dc ║ e3dd ║ e3de ║ e3df ║ e3e0 ║
# ║     ║     ║     ║     ║     ║
# ╠══════╬══════╬══════╬══════╬══════╣
# ║ e3e1 ║ e3e2 ║ e3e3 ║
# ║     ║     ║     ║
# ╠══════╬══════╬══════╬

moonfile="${XDG_DATA_HOME:-$HOME/.local/share}/moonphase"

[ -f "$moonfile" ] || { curl -sf "wttr.in/?format=%m" > "$moonfile" || exit 1 ;}

[ "$(stat -c %y "$moonfile" 2>/dev/null | cut -d' ' -f1)" = "$(date '+%Y-%m-%d')" ] ||
	{ curl -sf "wttr.in/?format=%m" > "$moonfile" || exit 1 ;}

icon="$(cat "$moonfile")"

case "$icon" in
	🌑) name="New" ;;
	🌒) name="Waxing Crescent" ;;
	🌓) name="First Quarter" ;;
	🌔) name="Waxing Gibbous" ;;
	🌕) name="Full" ;;
	🌖) name="Waning Gibbous" ;;
	🌗) name="Last Quarter" ;;
	🌘) name="Waning Crescent" ;;
	*) exit 1 ;;
esac

echo "${icon-?}"

case $BLOCK_BUTTON in
	3) notify-send "🌜 Moon phase module" "Displays current moon phase.
- 🌑: New
- 🌒: Waxing Crescent
- 🌓: First Quarter
- 🌔: Waxing Gibbous
- 🌕: Full
- 🌖: Waning Gibbous
- 🌗: Last Quarter
- 🌘: Waning Crescent" ;;
	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac
