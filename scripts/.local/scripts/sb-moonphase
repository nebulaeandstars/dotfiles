#!/bin/sh

# Shows the current moon phase.

# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘      â•‘ e38d â•‘ e38e â•‘ e38f â•‘ e390 â•‘
# â•‘      â•‘  î   â•‘  î   â•‘  î   â•‘  î   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e391 â•‘ e392 â•‘ e393 â•‘ e394 â•‘ e395 â•‘
# â•‘  î‘   â•‘  î’   â•‘  î“   â•‘  î”   â•‘  î•   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e396 â•‘ e397 â•‘ e398 â•‘ e399 â•‘ e39a â•‘
# â•‘  î–   â•‘  î—   â•‘  î˜   â•‘  î™   â•‘  îš   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e39b â•‘ e39c â•‘ e39d â•‘ e39e â•‘ e39f â•‘
# â•‘  î›   â•‘  îœ   â•‘  î   â•‘  î   â•‘  îŸ   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3a0 â•‘ e3a1 â•‘ e3a2 â•‘ e3a3 â•‘ e3a4 â•‘
# â•‘  î    â•‘  î¡   â•‘  î¢   â•‘  î£   â•‘  î¤   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3a5 â•‘ e3a6 â•‘ e3a7 â•‘ e3a8 â•‘
# â•‘  î¥   â•‘  î¦   â•‘  î§   â•‘  î¨   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬

# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3c8 â•‘ e3c9 â•‘ e3ca â•‘ e3cb â•‘ e3cc â•‘
# â•‘  îˆ   â•‘  î‰   â•‘  îŠ   â•‘  î‹   â•‘  îŒ   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3cd â•‘ e3ce â•‘ e3cf â•‘ e3d0 â•‘ e3d1 â•‘
# â•‘  î   â•‘  î   â•‘  î   â•‘  î   â•‘  î‘   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3d2 â•‘ e3d3 â•‘ e3d4 â•‘ e3d5 â•‘ e3d6 â•‘
# â•‘  î’   â•‘  î“   â•‘  î”   â•‘  î•   â•‘  î–   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3d7 â•‘ e3d8 â•‘ e3d9 â•‘ e3da â•‘ e3db â•‘
# â•‘  î—   â•‘  î˜   â•‘  î™   â•‘  îš   â•‘  î›   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3dc â•‘ e3dd â•‘ e3de â•‘ e3df â•‘ e3e0 â•‘
# â•‘  îœ   â•‘  î   â•‘  î   â•‘  îŸ   â•‘  î    â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•£
# â•‘ e3e1 â•‘ e3e2 â•‘ e3e3 â•‘
# â•‘  î¡   â•‘  î¢   â•‘  î£   â•‘
# â• â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•¬

moonfile="${XDG_DATA_HOME:-$HOME/.local/share}/moonphase"

[ -f "$moonfile" ] || { curl -sf "wttr.in/?format=%m" > "$moonfile" || exit 1 ;}

[ "$(stat -c %y "$moonfile" 2>/dev/null | cut -d' ' -f1)" = "$(date '+%Y-%m-%d')" ] ||
	{ curl -sf "wttr.in/?format=%m" > "$moonfile" || exit 1 ;}

icon="$(cat "$moonfile")"

case "$icon" in
	ğŸŒ‘) name="New" ;;
	ğŸŒ’) name="Waxing Crescent" ;;
	ğŸŒ“) name="First Quarter" ;;
	ğŸŒ”) name="Waxing Gibbous" ;;
	ğŸŒ•) name="Full" ;;
	ğŸŒ–) name="Waning Gibbous" ;;
	ğŸŒ—) name="Last Quarter" ;;
	ğŸŒ˜) name="Waning Crescent" ;;
	*) exit 1 ;;
esac

echo "${icon-?}"

case $BLOCK_BUTTON in
	3) notify-send "ğŸŒœ Moon phase module" "Displays current moon phase.
- ğŸŒ‘: New
- ğŸŒ’: Waxing Crescent
- ğŸŒ“: First Quarter
- ğŸŒ”: Waxing Gibbous
- ğŸŒ•: Full
- ğŸŒ–: Waning Gibbous
- ğŸŒ—: Last Quarter
- ğŸŒ˜: Waning Crescent" ;;
	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac
